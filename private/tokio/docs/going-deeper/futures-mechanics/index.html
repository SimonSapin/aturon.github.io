<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    
    <link rel="stylesheet" href="http://aturon.github.io/private/tokio/css/bootstrap-reboot.css">
    <link rel="stylesheet" href="http://aturon.github.io/private/tokio/css/bootstrap.css">
    <link rel="stylesheet" href="http://aturon.github.io/private/tokio/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://aturon.github.io/private/tokio/css/tokio.css">

    <title>Essential combinators</title>
  </head>
  <body>
    <nav class="navbar navbar-light bg-faded">
      <ul class="nav navbar-nav">
        <li class="nav-item">
          <a class="navbar-brand" href="http://aturon.github.io/private/tokio/"><img src="http://aturon.github.io/private/tokio/img/logo.png" width="44"
            height="40" class="align-middle" alt=""></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://aturon.github.io/private/tokio/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://aturon.github.io/private/tokio/docs/getting-started/tokio/">Documentation</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://aturon.github.io/private/tokio/community/">Community</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="http://aturon.github.io/private/tokio/blog/tokio-0/">Blog</a>
        </li>
      </ul>
    </nav>


<div class="tk-pageheader">
  <div class="container">
    <h1 class="display-4">Essential combinators</h1>
    <p class="lead">Common APIs for futures and stream programming</p>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-3">

      <nav class="leftnav">
        <div class="" id="">
          <h5>Getting started</h5>
          <hr/>

          <div class="" id="">
            <ul class="nav">
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/tokio/" class="text-muted">What is Tokio?</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/simple-server/" class="text-muted">Example: an echo server using proto</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/futures/" class="text-muted">Futures</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/db/" class="text-muted">Example: serving database content using proto</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/streams-and-sinks/" class="text-muted">Streams and sinks</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/reactor/" class="text-muted">Understanding event loops</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/core/" class="text-muted">High-level I/O using core</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/pipeline-server/" class="text-muted">Example: a simple pipelined server using core</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/tls/" class="text-muted">Example: a toy HTTP&#43;TLS client using core</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/getting-started/simple-client/" class="text-muted">Example: a client with proto</a>
              </li>
              
            </ul>
          </div>

          <br/>
          <h5>Going deeper</h5>
          <hr/>

          <div class="" id="">
            <ul class="nav">
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/futures-mechanics/" class="text-muted">Essential combinators</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/returning/" class="text-muted">Returning futures</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/futures-model/" class="text-muted">The futures-rs model in depth</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/synchronization/" class="text-muted">Synchronization</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/core-low-level/" class="text-muted">Low-level I/O using core</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/multiplex/" class="text-muted">Multiplexed protocols</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/streaming/" class="text-muted">Streaming protocols</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/tasks/" class="text-muted">Tasks and executors</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/examples/" class="text-muted">Larger examples</a>
              </li>
              
              <li class="active">
                <a href="http://aturon.github.io/private/tokio/docs/going-deeper/third-party/" class="text-muted">Third-party crates</a>
              </li>
              
            </ul>
          </div>
        </div>
      </nav>

    </div>
    <div class="col-md-9">
      <div class="tk-content">
        

<p>We saw a few of the most important combinators in the
<a href="../../getting-started/futures">futures</a> and
<a href="../../getting-started/streams-and-sinks">streams</a> overviews. Here we&rsquo;ll take a
look at a few more. It&rsquo;s also worth spending some time with the trait
documentation to familiarize yourself with the full range of combinators
available.</p>

<h3 id="some-concrete-futures-and-streams">Some concrete futures and streams</h3>

<p>Any value can be turned into an immediately complete future. There are a few
functions in the <code>future</code> module for creating such a future:</p>

<ul>
<li><a href="https://docs.rs/futures/0.1.7/futures/fn.ok.html"><code>ok</code></a>, which is analogous to <code>Result::Ok</code>: it treats the value you give it as an immediately successful future.</li>
<li><a href="https://docs.rs/futures/0.1.7/futures/fn.err.html"><code>err</code></a>, which is analogous to <code>Result::Err</code>: it treats the value you give it as an immediately failed future.</li>
<li><a href="https://docs.rs/futures/0.1.7/futures/fn.result.html"><code>result</code></a>, which lifts a result to an immediately-complete future.</li>
</ul>

<p>For streams, there are a few equivalents of an &ldquo;immediately ready&rdquo; stream:</p>

<ul>
<li><a href="https://docs.rs/futures/0.1.7/futures/stream/fn.iter.html"><code>iter</code></a>, which creates a stream that yields the same items as the underlying
iterator. The iterator produces <code>Result</code> values, and the first error terminates
the stream with that error.</li>
<li><a href="https://docs.rs/futures/0.1.7/futures/stream/fn.once.html"><code>once</code></a>, which creates a single-element stream from a <code>Result</code>.</li>
</ul>

<p>In addition to these constructors, there&rsquo;s also a function, <a href="https://docs.rs/futures/0.1.7/futures/fn.lazy.html"><code>lazy</code></a>, which
allows you to construct a future given a <em>closure</em> that will produce that future
later, on demand.</p>

<h3 id="intofuture">IntoFuture</h3>

<p>A crucial API to know about is the <a href="https://docs.rs/futures/0.1.7/futures/future/trait.IntoFuture.html"><code>IntoFuture</code></a> trait, which is a trait for
values that can be converted into futures. Most APIs that you think of as taking
futures actually work with this trait instead. The key reason: the trait is
implemented for <code>Result</code>, allowing you to return <code>Result</code> values in many places
that futures are expected.</p>

<h3 id="adapters">Adapters</h3>

<p>Like <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html"><code>Iterator</code></a>, the <code>Future</code>, <code>Stream</code> and <code>Sink</code> traits all come equipped
with a broad range of &ldquo;adapter&rdquo; methods. These methods all consume the receiving
object and return a new, wrapped one. For futures, you can use adapters to:</p>

<ul>
<li>Change the type of a future (<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.map"><code>map</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.map_err"><code>map_err</code></a>)</li>
<li>Run another future after one has completed (<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.then"><code>then</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.and_then"><code>and_then</code></a>,
<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.or_else"><code>or_else</code></a>)</li>
<li>Figure out which of two futures resolves first (<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.select"><code>select</code></a>)</li>
<li>Wait for two futures to both complete (<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.join"><code>join</code></a>)</li>
<li>Convert to a trait object (<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.boxed"><code>boxed</code></a>)</li>
<li>Convert unwinding into errors (<a href="https://docs.rs/futures/0.1.7/futures/future/trait.Future.html#method.catch_unwind"><code>catch_unwind</code></a>)</li>
</ul>

<p>For streams, there are a large set of adapters, including:</p>

<ul>
<li>Many in common with <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html"><code>Iterator</code></a>, like <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.map"><code>map</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.fold"><code>fold</code></a>,
<a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.collect"><code>collect</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.filter"><code>filter</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.zip"><code>zip</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.take"><code>take</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.skip"><code>skip</code></a> and so on. Note that <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.fold"><code>fold</code></a> and
<a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.collect"><code>collect</code></a> produce <em>futures</em>, and hence their result is computed
asynchronously.</li>
<li>Adapters for sequencing with futures (<a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.then"><code>then</code></a>,
<a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.and_then"><code>and_then</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.or_else"><code>or_else</code></a>)</li>
<li>Additional adapters for combining streams (<a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.merge"><code>merge</code></a>, <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.select"><code>select</code></a>)</li>
</ul>

<p>The <code>Sink</code> trait currently has fewer adapters; the most important ones were
covered in <a href="../../getting-started/streams-and-sinks">the introduction</a>.</p>

<p>Finally, an object that is both a stream and a sink can be broken into separate
stream and sink objects using the <a href="https://docs.rs/futures/0.1.7/futures/stream/trait.Stream.html#method.split"><code>split</code></a> adapter.</p>

<p>All adapters are zero-cost, meaning that no memory is allocated internally and
the implementation will optimize to what you would have otherwise written by
hand.</p>

<h3 id="error-handling">Error handling</h3>

<p>TODO: write this</p>

<ul>
<li>combinators know how to deal with errors. explain <code>then</code>, <code>and_then</code>, etc, and
examples of how errors propagate throuh <code>select</code> and <code>join</code></li>
<li>how to deal with panics</li>
</ul>

        
        <div class="tk-next"><b>Next up</b>: <a href = /docs/going-deeper/returning/>
         Returning futures</a></div>
      </div>
    </div>
  </div>
</div>

    <footer class="tk-footer">
      <div class="container text-muted">
        <div class="col-md-6">
          Copyright © 2016 Tokio Project
        </div>
        <div class="col-md-6">
          <div class="pull-right">
            <a href="https://twitter.com/tokio_rs" class="text-muted"><i class="fa fa-twitter" aria-hidden="true"></i></a>
            <a href="https://github.com/tokio-rs/tokio" class="text-muted"><i class="fa fa-github" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
    </footer>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="http://aturon.github.io/private/tokio/js/bootstrap.min.js"></script>
    <script src="http://aturon.github.io/private/tokio/js/highlight.js"></script>
    <script>
      $(function () {
        $("pre code").each(function(i, block) {
          
          hljs.highlightBlock(block);
        });
      });
    </script>
  </body>
</html>

